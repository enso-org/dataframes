version: 1.0.{build}
image: Visual Studio 2017
environment:
  PATH: C:\Python37-x64;C:\stack;%PATH%
  PythonDir: C:\Python37-x64
  DATAFRAMES_REPO_PATH: $(APPVEYOR_BUILD_FOLDER)

cache:
- C:\Users\appveyor\AppData\Roaming\stack\
- C:\Users\appveyor\AppData\Local\Programs\stack

build_script:
- python -m pip install numpy
- curl -sS -o stack.zip -L --insecure https://get.haskellstack.org/stable/windows-x86_64.zip
- 7z x stack.zip -y -oC:\stack stack.exe
- cd %APPVEYOR_BUILD_FOLDER%\scripts\
- stack run

artifacts:
- path: $(APPVEYOR_BUILD_FOLDER)\scripts\Dataframes-Win-x64-v141.7z
  name: Dataframes-Win-x64-v141

deploy:
  - provider: S3
    access_key_id: AKIAIFQRMRF6E4OOZNMQ
    secret_access_key:
      secure: /ALZ8SK6q7DFtIN1cU4+jM3KAIFY1/AVEZOyL3lCuSDynKxr/zDZLwAuPgieeE0r
    bucket: packages-luna
    region: us-west-2
    folder: dataframes/nightly/$(APPVEYOR_REPO_COMMIT)
    artifact: $(APPVEYOR_BUILD_FOLDER)\scripts\Dataframes-Win-x64-v141
